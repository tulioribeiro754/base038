<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Admin | BASE038</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS GLOBAL -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- PROTEÇÃO JWT -->
<script>
const token = localStorage.getItem("token");
if (!token) {
    window.location.href = "login.html";
}
</script>

<!-- HEADER -->
<header class="header">
    <div class="logo">BASE038</div>

    <nav class="nav">
        <a href="index.html">Site</a>
        <a href="#" onclick="logout()" class="btn-neon">Sair</a>
    </nav>
</header>

<!-- ADMIN -->
<section class="admin container">
    <h1>Painel Administrativo</h1>

    <!-- FORM PRODUTO -->
    <div class="admin-card">
        <h3>Cadastrar Produto</h3>

        <input type="text" id="nome" placeholder="Nome do produto">
        <input type="number" id="preco" placeholder="Preço">
        <input type="text" id="categoria" placeholder="Categoria (masculino/feminino/unissex)">
        <input type="text" id="imagem" placeholder="URL da imagem">

        <button class="btn-neon" onclick="criarProduto()">Cadastrar</button>
    </div>

    <!-- LISTA -->
    <div class="admin-card">
        <h3>Produtos Cadastrados</h3>
        <div id="listaProdutos"></div>
    </div>
</section>

<!-- FOOTER -->
<footer class="footer">
    © 2026 BASE038 — Admin
</footer>

<!-- SCRIPT -->
<script>
async function criarProduto() {
    const produto = {
        nome: nome.value,
        preco: Number(preco.value),
        categoria: categoria.value,
        imagem: imagem.value
    };

    const res = await fetch("http://localhost:3000/api/produtos", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": token
        },
        body: JSON.stringify(produto)
    });

    if (res.ok) {
        alert("Produto cadastrado!");
        listarProdutos();
    } else {
        alert("Erro ao cadastrar");
    }
}

async function listarProdutos() {
    const res = await fetch("http://localhost:3000/api/produtos");
    const produtos = await res.json();

    listaProdutos.innerHTML = "";

    produtos.forEach(p => {
        listaProdutos.innerHTML += `
            <div class="produto-admin">
                <img src="${p.imagem}">
                <div>
                    <p>${p.nome}</p>
                    <span>R$ ${p.preco.toFixed(2)}</span>
                </div>
                <button onclick="excluirProduto('${p._id}')">Excluir</button>
            </div>
        `;
    });
}

async function excluirProduto(id) {
    await fetch(`http://localhost:3000/api/produtos/${id}`, {
        method: "DELETE",
        headers: {
            "Authorization": token
        }
    });

    listarProdutos();
}

function logout() {
    localStorage.removeItem("token");
    window.location.href = "login.html";
}

document.addEventListener("DOMContentLoaded", listarProdutos);
</script>

</body>
</html>
